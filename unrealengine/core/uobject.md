---
description: >-
  çœŸè¦å°†UObjectçš„è¯ï¼Œè‡ªå·±ç›®å‰çš„é“è¡Œå®åœ¨å¤ªæµ…ï¼Œè¿™ä¸€å—å†…å®¹åˆååˆ†çš„æ ¸å¿ƒï¼Œæ‰€ä»¥ä¸‹é¢çš„å†…å®¹å¯ä»¥è¯´æ˜¯è‡ªå·±é›†ç™¾å®¶ä¹‹æ‰€é•¿ï¼Œè‡ªå·±å½’çº³æ€»ç»“çš„ä¸€ä¸ªç»“æœã€‚è¿™æ˜¯ä¸€ç¯‡ç¬”è®°ï¼Œæ˜¯ä»å„å¤„èµ„æ–™å­¦åˆ°çš„ä¸œè¥¿çš„ä¸€ä¸ªç®€å•çš„æ±‡æ€»å’Œæ•´ä½“ã€‚
coverY: 0
---

# ğŸ– UObject

## UObject

UObjectå¹¶ä¸æ˜¯æœ€ä¸Šå±‚çš„åŸºç±»ï¼Œå…¶ä¸­æœ€ä¸Šå±‚çš„åŸºç±»æ˜¯UObjectBaseï¼Œä»–åœ¨åˆ›å»ºçš„æ—¶å€™ä¼šæŠŠè‡ªå·±äº¤ç»™ä¸¤ä¸ªå…¨å±€å®¹å™¨æ¥è¿›è¡Œç®¡ç†ï¼Œåœ¨é”€æ¯çš„æ—¶å€™ä¼šæŠŠè‡ªå·±ä»å…¨å±€å®¹å™¨ä¸­å»é™¤ã€‚



<img src="../../.gitbook/assets/file.excalidraw.svg" alt="" class="gitbook-drawing">

```cpp
class FUObjectHashTables
{
	/** Critical section that guards against concurrent adds from multiple threads */
	FCriticalSection CriticalSection;

public:

	/** Hash sets */
	TBucketMap<int32> Hash;   
	TMultiMap<int32, uint32> HashOuter;

	/** Map of object to their outers, used to avoid an object iterator to find such things. **/
	TBucketMap<UObjectBase*> ObjectOuterMap;   //å¯¹è±¡ä¹‹é—´çš„çˆ¶å­æ˜ å°„ //ä¾‹å¦‚Actor å’ŒActorComponentçš„å…³ç³»
	TBucketMap<UClass*> ClassToObjectListMap;  // UClasså’Œ UObjectBaseä¹‹é—´çš„æ˜ å°„å…³ç³»
	TMap<UClass*, TSet<UClass*> > ClassToChildListMap; // çˆ¶ç±»å’Œå­ç±»ä¹‹é—´çš„æ˜ å°„å…³ç³»
	TAtomic<uint64> ClassToChildListMapVersion;

	/** Map of package to the object their contain. */
	TBucketMap<UPackage*> PackageToObjectListMap;  //UPackage å’ŒUobjectä¹‹é—´çš„æ˜ å°„å…³ç³»
	/** Map of object to their external package. */  
	TMap<UObjectBase*, UPackage*> ObjectToPackageMap;   //UObject å’Œ UPackage ä¹‹é—´çš„æ˜ å°„å…³ç³» 

	FUObjectHashTables()
		: ClassToChildListMapVersion(0)
	{
	}
}
```

## æ ¹æ®ä¸Šé¢ä»£ç çš„å†…å®¹å¯ä»¥å¾ˆå®¹æ˜“ææ¸…æ¥šFindObjectçš„å†…å®¹ã€‚



##

## DisregardForGC

UObjectArrayçš„ä¸€ä¸ªé‡è¦æ¦‚å¿µï¼Œç§°ä¸ºDisregardForGCã€‚UE4æœ‰ä¸€éƒ¨åˆ†UObjectå¸¸é©»å†…å­˜ï¼Œæ¯”å¦‚C++ç±»åå°„ä¿¡æ¯å¯¹åº”çš„UObjectï¼Œä»–ä»¬æ°¸è¿œä¸ä¼šè¢«GCï¼Œè¿™äº›UObjectè¢«ç§°ä¸ºDisregardForGC Object. Disregardçš„æ„æ€å°±æ˜¯å¿½è§† è½»è§†çš„æ„æ€ã€‚é‚£è¿™ä¸ªè¯çš„æ„æ€å°±æ˜¯è¢«GCæ‰€å¿½è§†çš„æ„æ€ã€‚

æ•°ç»„å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†ï¼Œå‰é¢çš„éƒ¨åˆ†å­˜å‚¨DisregardForGC Objectï¼Œåé¢çš„éƒ¨åˆ†

UEä¸­DisregardForGC Objectæœ‰æ•°é‡é™åˆ¶ï¼Œé€šè¿‡gc.MaxObjectsNotConsideredByGCå‚æ•°é…ç½®ï¼Œé»˜è®¤ä¸º0ï¼ŒUObjectArrayåˆå§‹ä¼šç”³è¯·è¿™ä¹ˆå¤šçš„æ§½ä½ã€‚ä½†è¿™ä¸ªé™åˆ¶æ˜¯â€œè½¯é™åˆ¶â€ï¼Œå¦‚æœDisregardForGC Objectè¶…è¿‡äº†é™åˆ¶ï¼Œä½†è¿˜æœªåˆ›å»ºæ™®é€šObjectï¼Œé‚£ä¹ˆå¯ç»§ç»­å¢åŠ ï¼Œä¼šä»¥è°ƒç”¨CloseDisregardForGCè°ƒç”¨æ—¶æ•°é‡ä¸ºå‡†ã€‚

## CDO å¯¹è±¡

ä½¿ç”¨`UClass::GetDefaultObject()` è·å–åˆ°çš„ç±»ä¸ºç±»çš„CDOå¯¹è±¡ã€‚ä»–ç”±å¼•æ“è‡ªåŠ¨åˆ›å»º`UObjectLoadAllCompiledInDefaultProperties(TArray<UClass*>& OutAllNewClasses)`

ï¼Œç¼–ç¨‹çš„æ—¶å€™

{% embed url="https://1danielcoelho.github.io/unreal-engine-basics-base-classes/" %}

{% @github-files/github-code-block %}

## [https://github.com/donaldwuid/unreal\_source\_explained/blob/master/main/initialization.md](https://github.com/donaldwuid/unreal\_source\_explained/blob/master/main/initialization.md)

## Outerå¯¹è±¡ï¼Œçˆ¶å­å¯¹è±¡

ç”±UObject::GetOuter() è·å–è‡ªå·±çš„Outerå¯¹è±¡ã€‚ä»»ä½•å¯¹è±¡çš„OuterMostä¹Ÿå°±æ˜¯æœ€ä¸Šé¢çš„å¯¹è±¡éƒ½æ˜¯UPackageã€‚é‚£ä¹ˆåˆ°åº•ä»€ä¹ˆæ˜¯Outerï¼ŒOuterè¡¨ç¤ºå¯¹è±¡ä¹‹é—´çš„æ‰€å±å…³ç³»ã€‚æˆ‘ä¹‹å‰ä¸€ç›´åŒ…å«å…³ç³»ä½†æ˜¯å¥½åƒä¹Ÿä¸æ˜¯ï¼Œæœ‰æ—¶å€™ä¹Ÿæ˜¯ã€‚Levelä¸­çš„æ‰€æœ‰Actorçš„Outeræ˜¯Levelï¼ŒLevelçš„Outeræ˜¯Map.

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

{% embed url="https://forums.unrealengine.com/t/what-is-the-purpose-of-a-uobjects-outer/647169/3" %}

æƒ³å†™ä¸€ä¸‹å¤§æ‹›çš„å°æ’ä»¶ã€‚

## UPackage å’Œé¡¶å±‚å¯¹è±¡

æ²¿ç€ä¸€ä¸ªUObjectå¯¹è±¡çš„Outeré“¾å‘ä¸Šæœ€ç»ˆèƒ½æ‰¾åˆ°ä¸€ä¸ªUPackageå¯¹è±¡ï¼Œå®ƒå†³å®šäº†å¯¹è±¡ä¼šè¢«åºåˆ—åŒ–åœ¨å“ªé‡Œã€‚æˆ‘ä»¬å°†UPackageçš„ç›´æ¥å­å¯¹è±¡ç§°ä¹‹ä¸ºé¡¶å±‚å¯¹è±¡ï¼Œ

## UObjectFlags

æè¿°äº†ä¸€ä¸ªå¯¹è±¡å®ä¾‹ã€‚è¿™é‡Œçš„å®ä¾‹åŒ…æ‹¬ä»–æ˜¯ä»€ä¹ˆç±»å‹ï¼Œæ¯”å¦‚\`RF\_ClassDefacultObjectè¡¨æ˜ä»–æ˜¯CDOã€‚è¿˜å¯ä»¥æ ‡è®°å’Œåƒåœ¾å›æ”¶ç›¸å…³ï¼Œæ¯”å¦‚RF\_MArkAsRootSetè¡¨æ˜è¿™ä¸ªå¯¹è±¡è¢«æ ‡è®°ä¸ºRootSetï¼Œå³ä½¿æœªè¢«å¼•ç”¨ä¹Ÿä¸ä¼šè¢«GCã€‚è¿˜ä¼šæ ‡è®°ä¸€ä¸ªUObjectçš„ç”Ÿå‘½å‘¨æœŸé˜¶æ®µã€‚



* InternalIndexï¼šGUObjectArrayçš„ç´¢å¼•ã€‚GUObjectArrayæ˜¯ä¸€ä¸ªå…¨å±€çš„UObjectæ•°ç»„ï¼Œæ¯æ„é€ ä¸€ä¸ªå¯¹è±¡çš„æ—¶å€™ï¼Œéƒ½ä¼šåŠ å…¥è¿™ä¸ªæ•°ç»„ä¸­ã€‚
* ClassPrivate: è¯¥å¯¹è±¡æ‰€å±çš„ç±»
* NamePrivate: æ­¤å¯¹è±¡çš„åç§°
* OuterPrivate: æ‹¥æœ‰è¯¥å¯¹è±¡çš„å¯¹è±¡

> åœ¨è¿è¡Œçš„æ—¶å€™å¼•ç”¨è‡ªå·±çš„å¯¹è±¡å¯èƒ½æœ‰æ— ç©·å¤šä¸ªï¼Œä½†è‡ªå·±çš„Outeræœ‰ä¸”åªæœ‰ä¸€ä¸ªã€‚Outerçš„**å¯¹è±¡è¯­ä¹‰å°±æ˜¯çœŸæ­£æ‹¥æœ‰è‡ªå·±çš„é‚£ä¸ªå¯¹è±¡ï¼Œä¾‹å¦‚åºåˆ—åŒ–æ—¶åº”è¯¥å°†è‡ªå·±çš„æ•°æ®ä¿å­˜åœ¨Outerä¸­ï¼Œè€Œåœ¨å…¶ä»–å¼•ç”¨è‡ªå·±çš„å¯¹è±¡ä¸­ä»…éœ€è¦ä¿å­˜è‡ªå·±çš„è·¯å¾„å³å¯ã€‚æˆ‘ä»¬å¯ä»¥å°†ä¸€ä¸ªå¯¹è±¡çš„Outerç§°ä¸ºè¿™ä¸ªå¯¹è±¡çš„çˆ¶å¯¹è±¡**









é¦–å…ˆçœ‹ä»å¤§è±¡æ— å½¢å½“ä¸­äº†è§£åˆ°çš„å†…å®¹ã€‚å¤§è±¡æ— å½¢è¿™æœ¬ä¹¦é‡Œé¢è®²åˆ°çš„å†…å®¹è¿˜æ˜¯æŒºæ·±çš„ã€‚ä½†æ˜¯æ¯ä¸€éƒ¨åˆ†çš„å†…å®¹éƒ½æ²¡æœ‰é•¿ç¯‡çš„å¾ˆæ·±åˆ»çš„å»è®¨è®ºï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯ç®€å•å¼€ä¸€ä¸ªå¤´å°±ç»“æŸäº†ã€‚





## UObject çš„åˆ›å»ºå’Œé”€æ¯

<figure><img src="../../.gitbook/assets/image (2).png" alt=""><figcaption><p>UObjectå¯¹è±¡çš„åˆ›å»ºè¿‡ç¨‹</p></figcaption></figure>







## UObjectçš„åå°„

å…³äºåå°„è¿™æ˜¯ä¸€ä¸ªååˆ†å·¨å¤§çš„è¯é¢˜ï¼Œä¸‹é¢æˆ‘ä»¬å°±è¯¦ç»†çš„è®¨è®ºä¸€ä¸‹è¿™ä¸€éƒ¨åˆ†ã€‚é¦–å…ˆå¦‚ä½•ç†è§£åå°„ã€‚å½“ç¨‹åºè¢«ç¼–è¯‘ä¸ºæœºå™¨ç çš„æ—¶å€™ï¼Œç¨‹åºæ˜¯ä¸èƒ½ç†è§£æˆ‘ä»¬å†™ä»£ç çš„æ—¶å€™æ‰€è°“çš„ç±»ã€æ–¹æ³•ã€å‡½æ•°è¿™äº›æ¦‚å¿µçš„ã€‚åªæœ‰ä¸€æ¡æ¡å†°å†·çš„æŒ‡ä»¤ã€‚ä¸ºäº†åœ¨ç¨‹åºè¿è¡Œçš„æ—¶å€™ï¼Œè·å–ç›¸å…³ä¿¡æ¯ã€‚å°±è¦ç”¨åˆ°åå°„ã€‚è¯´ç™½ç‚¹å°±æ˜¯å°†æˆ‘ä»¬å†™çš„ç±»å‡½æ•°è¿™äº›å†…å®¹ç”¨å°æœ¬æœ¬è®°å½•ä¸‹æ¥ï¼Œåœ¨è¿™é‡Œè¿™ä¸ªå°æœ¬æœ¬å°±æ˜¯UClassç±»ï¼ˆæœ€ä¸ºæ™®éçš„ä¸€ç§æƒ…å†µï¼‰ã€‚

å¯èƒ½æ¯ä¸€ä¸ªç¬¬ä¸€æ¬¡å†™UEçš„ä»£ç çš„äººéƒ½å¯¹ä»£ç ä¸­çš„ä¸€äº›å®ï¼Œä¸€äº›æ–‡ä»¶æ„Ÿåˆ°å¥‡æ€ªã€‚å…¶å®è¿™äº›å†…å®¹æ‰“å¤§éƒ¨åˆ†æƒ…å†µä¸‹éƒ½æ˜¯ä¸ºåå°„æ¥æœåŠ¡çš„ã€‚

å½“æˆ‘ä»¬å®Œæˆä»£ç çš„ç¼–å†™çš„æ—¶å€™ï¼Œé¦–å…ˆæ˜¯UHTè¿™ä¸ªå·¥å…·æ‰«ææ–‡ä»¶ï¼Œçœ‹é‚£ä¸ªæ–‡ä»¶ä¿®æ”¹äº†ã€‚å¦‚æœæ–‡ä»¶ä¿®æ”¹äº†ã€‚UHTå°±ä¼šæ‰«æç‰¹å®šçš„å®ï¼Œæ ¹æ®å®ç”Ÿæˆç‰¹å®šçš„ä»£ç ã€‚è¿™äº›ä»£ç ä¼šç”Ÿæˆåœ¨ç‰¹å®šçš„åœ°æ–¹ã€‚è¿™äº›ä»£ç å½“ä¸­ä¸€éƒ¨åˆ†å°±è®°å½•äº†æˆ‘ä»¬ç±»çš„ä¿¡æ¯ï¼Œå®ƒå·²ç»æˆä¸ºäº†æˆ‘ä»¬çš„ç±»çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”éšç€æˆ‘ä»¬çš„ç±»çš„ç¼–è¯‘è€Œä¸€èµ·ç¼–è¯‘ã€‚

é‚£ä¹ˆæˆ‘ä»¬å°±ä»ä¸€ä¸ªç®€å•çš„ä»£ç å¼€å§‹çœ‹ã€‚GENERATE\_BODY()







## UObjectçš„æ’¤é”€åŠŸèƒ½





## åºåˆ—åŒ–åŠŸèƒ½





## UClass



## EClassFlags

> CLASS\_NativeæŒ‡çš„æ˜¯åœ¨C++é‡Œå®šä¹‰çš„ç±»ï¼Œç”¨æ¥å’Œè“å›¾ç±»åŒºåˆ†ã€‚CLASS\_IntrinsicæŒ‡çš„æ˜¯å‘Šè¯‰UHTä¸è¦å¸®æˆ‘ç”Ÿæˆåå°„ä»£ç ï¼Œæˆ‘è¦è‡ªå·±å†™ï¼Œä¸€èˆ¬æ˜¯å¼•æ“å†…éƒ¨çš„ç±»æ‰ä¼šç”¨åˆ°ã€‚



å…³äºä¸¤ä¸ª

```
RF_ClassDefaultObject|RF_ArchetypeObject
```

æ‰€æœ‰çš„CDOå¯¹è±¡éƒ½åŒæ—¶æ‹¥æœ‰ä¸Šé¢çš„ä¸¤ä¸ªflagsï¼Œä½†æ˜¯CDOçš„ç»„ä»¶åªæœ‰ä¸Šé¢çš„ç¬¬äºŒä¸ªflag.

> å¼•æ“åœ¨æ„å»ºç»„ä»¶å¯¹è±¡çš„æ—¶å€™ä¼šä½¿ç”¨æ‹·è´åŸå‹çš„æ–¹å¼æ¥å¯¹å…¶å®ä¾‹åŒ–â€”â€”æ—¢ç„¶å·²ç»æœ‰äº†ç°æˆçš„â€œæ ‡å‡†ç­”æ¡ˆâ€åœ¨ï¼Œä¸ºä»€ä¹ˆä¸ç›´æ¥â€œæŠ„ç­”æ¡ˆâ€å‘¢ï¼Ÿä½¿ç”¨åŸå‹æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œé€Ÿåº¦æ¯”newä¸€ä¸ªå‡ºæ¥æ›´å¿«ï¼Œè€Œä¸”ç›¸æ¯”æ‹·è´æ„é€ å‡½æ•°ï¼Œåˆ©ç”¨åŸå‹å¯ä»¥å¤„ç†â€œæ–°å¯¹è±¡æ˜¯æ´¾ç”Ÿç±»â€çš„æƒ…å†µã€‚

FObjectInitializer çš„ä¸»è¦ä½œç”¨è²Œä¼¼ä½“ç°åœ¨å­å¯¹è±¡çš„æ„é€ ä¸Šã€‚

&#x20;





